{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nvar React = require(\"react\");\n\nvar fs = require(\"fs\");\n\nvar _require = require(\"path\"),\n    join = _require.join;\n\nvar _require2 = require(\"react-dom/server\"),\n    renderToString = _require2.renderToString,\n    renderToStaticMarkup = _require2.renderToStaticMarkup;\n\nvar _require3 = require(\"@reach/router\"),\n    ServerLocation = _require3.ServerLocation,\n    Router = _require3.Router,\n    isRedirect = _require3.isRedirect;\n\nvar _require4 = require(\"lodash\"),\n    get = _require4.get,\n    merge = _require4.merge,\n    isObject = _require4.isObject,\n    flatten = _require4.flatten,\n    uniqBy = _require4.uniqBy,\n    flattenDeep = _require4.flattenDeep,\n    replace = _require4.replace,\n    concat = _require4.concat,\n    memoize = _require4.memoize;\n\nvar _require5 = require(\"./route-announcer-props\"),\n    RouteAnnouncerProps = _require5.RouteAnnouncerProps;\n\nvar apiRunner = require(\"./api-runner-ssr\");\n\nvar syncRequires = require(\"$virtual/sync-requires\");\n\nvar _require6 = require(\"gatsby/package.json\"),\n    gatsbyVersion = _require6.version;\n\nvar _require7 = require(\"./find-path\"),\n    grabMatchParams = _require7.grabMatchParams;\n\nvar stats = JSON.parse(fs.readFileSync(process.cwd() + \"/public/webpack.stats.json\", \"utf-8\"));\nvar chunkMapping = JSON.parse(fs.readFileSync(process.cwd() + \"/public/chunk-map.json\", \"utf-8\"));\n\nvar testRequireError = function testRequireError(moduleName, err) {\n  var regex = new RegExp(\"Error: Cannot find module\\\\s.\" + moduleName);\n  var firstLine = err.toString().split(\"\\n\")[0];\n  return regex.test(firstLine);\n};\n\nvar Html;\n\ntry {\n  Html = require(\"../src/html\");\n} catch (err) {\n  if (testRequireError(\"../src/html\", err)) {\n    Html = require(\"./default-html\");\n  } else {\n    throw err;\n  }\n}\n\nHtml = Html && Html.__esModule ? Html.default : Html;\n\nvar getPageDataPath = function getPageDataPath(path) {\n  var fixedPagePath = path === \"/\" ? \"index\" : path;\n  return join(\"page-data\", fixedPagePath, \"page-data.json\");\n};\n\nvar getPageDataUrl = function getPageDataUrl(pagePath) {\n  var pageDataPath = getPageDataPath(pagePath);\n  return __PATH_PREFIX__ + \"/\" + pageDataPath;\n};\n\nvar getStaticQueryUrl = function getStaticQueryUrl(hash) {\n  return __PATH_PREFIX__ + \"/page-data/sq/d/\" + hash + \".json\";\n};\n\nvar getPageData = function getPageData(pagePath) {\n  var pageDataPath = getPageDataPath(pagePath);\n  var absolutePageDataPath = join(process.cwd(), \"public\", pageDataPath);\n  var pageDataRaw = fs.readFileSync(absolutePageDataPath);\n\n  try {\n    return JSON.parse(pageDataRaw.toString());\n  } catch (err) {\n    return null;\n  }\n};\n\nvar appDataPath = join(\"page-data\", \"app-data.json\");\nvar getAppDataUrl = memoize(function () {\n  var appData;\n\n  try {\n    var absoluteAppDataPath = join(process.cwd(), \"public\", appDataPath);\n    var appDataRaw = fs.readFileSync(absoluteAppDataPath);\n    appData = JSON.parse(appDataRaw.toString());\n\n    if (!appData) {\n      return null;\n    }\n  } catch (err) {\n    return null;\n  }\n\n  return __PATH_PREFIX__ + \"/\" + appDataPath;\n});\n\nvar loadPageDataSync = function loadPageDataSync(pagePath) {\n  var pageDataPath = getPageDataPath(pagePath);\n  var pageDataFile = join(process.cwd(), \"public\", pageDataPath);\n\n  try {\n    var pageDataJson = fs.readFileSync(pageDataFile);\n    return JSON.parse(pageDataJson);\n  } catch (error) {\n    return null;\n  }\n};\n\nvar createElement = React.createElement;\nexport var sanitizeComponents = function sanitizeComponents(components) {\n  var componentsArray = ensureArray(components);\n  return componentsArray.map(function (component) {\n    if (__ASSET_PREFIX__ && component.props.rel === \"manifest\") {\n      return React.cloneElement(component, {\n        href: replace(component.props.href, __ASSET_PREFIX__, \"\")\n      });\n    }\n\n    return component;\n  });\n};\n\nvar ensureArray = function ensureArray(components) {\n  if (Array.isArray(components)) {\n    return flattenDeep(components.filter(function (val) {\n      return Array.isArray(val) ? val.length > 0 : val;\n    }));\n  } else {\n    return components ? [components] : [];\n  }\n};\n\nexport default (function (pagePath, callback) {\n  var _postBodyComponents;\n\n  var bodyHtml = \"\";\n  var headComponents = [React.createElement(\"meta\", {\n    name: \"generator\",\n    content: \"Gatsby \" + gatsbyVersion,\n    key: \"generator-\" + gatsbyVersion\n  })];\n  var htmlAttributes = {};\n  var bodyAttributes = {};\n  var preBodyComponents = [];\n  var postBodyComponents = [];\n  var bodyProps = {};\n\n  var replaceBodyHTMLString = function replaceBodyHTMLString(body) {\n    bodyHtml = body;\n  };\n\n  var setHeadComponents = function setHeadComponents(components) {\n    headComponents = headComponents.concat(sanitizeComponents(components));\n  };\n\n  var setHtmlAttributes = function setHtmlAttributes(attributes) {\n    htmlAttributes = merge(htmlAttributes, attributes);\n  };\n\n  var setBodyAttributes = function setBodyAttributes(attributes) {\n    bodyAttributes = merge(bodyAttributes, attributes);\n  };\n\n  var setPreBodyComponents = function setPreBodyComponents(components) {\n    preBodyComponents = preBodyComponents.concat(sanitizeComponents(components));\n  };\n\n  var setPostBodyComponents = function setPostBodyComponents(components) {\n    postBodyComponents = postBodyComponents.concat(sanitizeComponents(components));\n  };\n\n  var setBodyProps = function setBodyProps(props) {\n    bodyProps = merge({}, bodyProps, props);\n  };\n\n  var getHeadComponents = function getHeadComponents() {\n    return headComponents;\n  };\n\n  var replaceHeadComponents = function replaceHeadComponents(components) {\n    headComponents = sanitizeComponents(components);\n  };\n\n  var getPreBodyComponents = function getPreBodyComponents() {\n    return preBodyComponents;\n  };\n\n  var replacePreBodyComponents = function replacePreBodyComponents(components) {\n    preBodyComponents = sanitizeComponents(components);\n  };\n\n  var getPostBodyComponents = function getPostBodyComponents() {\n    return postBodyComponents;\n  };\n\n  var replacePostBodyComponents = function replacePostBodyComponents(components) {\n    postBodyComponents = sanitizeComponents(components);\n  };\n\n  var pageData = getPageData(pagePath);\n  var pageDataUrl = getPageDataUrl(pagePath);\n  var appDataUrl = getAppDataUrl();\n  var componentChunkName = pageData.componentChunkName,\n      _pageData$staticQuery = pageData.staticQueryHashes,\n      staticQueryHashes = _pageData$staticQuery === void 0 ? [] : _pageData$staticQuery;\n  var staticQueryUrls = staticQueryHashes.map(getStaticQueryUrl);\n\n  var RouteHandler = function (_React$Component) {\n    _inherits(RouteHandler, _React$Component);\n\n    var _super = _createSuper(RouteHandler);\n\n    function RouteHandler() {\n      _classCallCheck(this, RouteHandler);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(RouteHandler, [{\n      key: \"render\",\n      value: function render() {\n        var _pageData$result, _pageData$result$page;\n\n        var props = _objectSpread(_objectSpread(_objectSpread({}, this.props), pageData.result), {}, {\n          params: _objectSpread(_objectSpread({}, grabMatchParams(this.props.location.pathname)), ((_pageData$result = pageData.result) == null ? void 0 : (_pageData$result$page = _pageData$result.pageContext) == null ? void 0 : _pageData$result$page.__params) || {}),\n          pathContext: pageData.result ? pageData.result.pageContext : undefined\n        });\n\n        var pageElement = createElement(syncRequires.components[componentChunkName], props);\n        var wrappedPage = apiRunner(\"wrapPageElement\", {\n          element: pageElement,\n          props: props\n        }, pageElement, function (_ref) {\n          var result = _ref.result;\n          return {\n            element: result,\n            props: props\n          };\n        }).pop();\n        return wrappedPage;\n      }\n    }]);\n\n    return RouteHandler;\n  }(React.Component);\n\n  var routerElement = React.createElement(ServerLocation, {\n    url: \"\" + __BASE_PATH__ + pagePath\n  }, React.createElement(Router, {\n    id: \"gatsby-focus-wrapper\",\n    baseuri: __BASE_PATH__\n  }, React.createElement(RouteHandler, {\n    path: \"/*\"\n  })), React.createElement(\"div\", RouteAnnouncerProps));\n  var bodyComponent = apiRunner(\"wrapRootElement\", {\n    element: routerElement,\n    pathname: pagePath\n  }, routerElement, function (_ref2) {\n    var result = _ref2.result;\n    return {\n      element: result,\n      pathname: pagePath\n    };\n  }).pop();\n  apiRunner(\"replaceRenderer\", {\n    bodyComponent: bodyComponent,\n    replaceBodyHTMLString: replaceBodyHTMLString,\n    setHeadComponents: setHeadComponents,\n    setHtmlAttributes: setHtmlAttributes,\n    setBodyAttributes: setBodyAttributes,\n    setPreBodyComponents: setPreBodyComponents,\n    setPostBodyComponents: setPostBodyComponents,\n    setBodyProps: setBodyProps,\n    pathname: pagePath,\n    pathPrefix: __PATH_PREFIX__\n  });\n\n  if (!bodyHtml) {\n    try {\n      bodyHtml = renderToString(bodyComponent);\n    } catch (e) {\n      if (!isRedirect(e)) throw e;\n    }\n  }\n\n  var scriptsAndStyles = flatten([\"app\", componentChunkName].map(function (s) {\n    var fetchKey = \"assetsByChunkName[\" + s + \"]\";\n    var chunks = get(stats, fetchKey);\n    var namedChunkGroups = get(stats, \"namedChunkGroups\");\n\n    if (!chunks) {\n      return null;\n    }\n\n    chunks = chunks.map(function (chunk) {\n      if (chunk === \"/\") {\n        return null;\n      }\n\n      return {\n        rel: \"preload\",\n        name: chunk\n      };\n    });\n    namedChunkGroups[s].assets.forEach(function (asset) {\n      return chunks.push({\n        rel: \"preload\",\n        name: asset\n      });\n    });\n    var childAssets = namedChunkGroups[s].childAssets;\n\n    var _loop = function _loop(rel) {\n      chunks = concat(chunks, childAssets[rel].map(function (chunk) {\n        return {\n          rel: rel,\n          name: chunk\n        };\n      }));\n    };\n\n    for (var rel in childAssets) {\n      _loop(rel);\n    }\n\n    return chunks;\n  })).filter(function (s) {\n    return isObject(s);\n  }).sort(function (s1, s2) {\n    return s1.rel == \"preload\" ? -1 : 1;\n  });\n  scriptsAndStyles = uniqBy(scriptsAndStyles, function (item) {\n    return item.name;\n  });\n  var scripts = scriptsAndStyles.filter(function (script) {\n    return script.name && script.name.endsWith(\".js\");\n  });\n  var styles = scriptsAndStyles.filter(function (style) {\n    return style.name && style.name.endsWith(\".css\");\n  });\n  apiRunner(\"onRenderBody\", {\n    setHeadComponents: setHeadComponents,\n    setHtmlAttributes: setHtmlAttributes,\n    setBodyAttributes: setBodyAttributes,\n    setPreBodyComponents: setPreBodyComponents,\n    setPostBodyComponents: setPostBodyComponents,\n    setBodyProps: setBodyProps,\n    pathname: pagePath,\n    loadPageDataSync: loadPageDataSync,\n    bodyHtml: bodyHtml,\n    scripts: scripts,\n    styles: styles,\n    pathPrefix: __PATH_PREFIX__\n  });\n  scripts.slice(0).reverse().forEach(function (script) {\n    headComponents.push(React.createElement(\"link\", {\n      as: \"script\",\n      rel: script.rel,\n      key: script.name,\n      href: __PATH_PREFIX__ + \"/\" + script.name\n    }));\n  });\n\n  if (pageData) {\n    headComponents.push(React.createElement(\"link\", {\n      as: \"fetch\",\n      rel: \"preload\",\n      key: pageDataUrl,\n      href: pageDataUrl,\n      crossOrigin: \"anonymous\"\n    }));\n  }\n\n  staticQueryUrls.forEach(function (staticQueryUrl) {\n    return headComponents.push(React.createElement(\"link\", {\n      as: \"fetch\",\n      rel: \"preload\",\n      key: staticQueryUrl,\n      href: staticQueryUrl,\n      crossOrigin: \"anonymous\"\n    }));\n  });\n\n  if (appDataUrl) {\n    headComponents.push(React.createElement(\"link\", {\n      as: \"fetch\",\n      rel: \"preload\",\n      key: appDataUrl,\n      href: appDataUrl,\n      crossOrigin: \"anonymous\"\n    }));\n  }\n\n  styles.slice(0).reverse().forEach(function (style) {\n    if (style.rel === \"prefetch\") {\n      headComponents.push(React.createElement(\"link\", {\n        as: \"style\",\n        rel: style.rel,\n        key: style.name,\n        href: __PATH_PREFIX__ + \"/\" + style.name\n      }));\n    } else {\n      headComponents.unshift(React.createElement(\"style\", {\n        \"data-href\": __PATH_PREFIX__ + \"/\" + style.name,\n        id: \"gatsby-global-css\",\n        dangerouslySetInnerHTML: {\n          __html: fs.readFileSync(join(process.cwd(), \"public\", style.name), \"utf-8\")\n        }\n      }));\n    }\n  });\n  var windowPageData = \"/*<![CDATA[*/window.pagePath=\\\"\" + pagePath + \"\\\";/*]]>*/\";\n  postBodyComponents.push(React.createElement(\"script\", {\n    key: \"script-loader\",\n    id: \"gatsby-script-loader\",\n    dangerouslySetInnerHTML: {\n      __html: windowPageData\n    }\n  }));\n  var scriptChunkMapping = \"/*<![CDATA[*/window.___chunkMapping=\" + JSON.stringify(chunkMapping) + \";/*]]>*/\";\n  postBodyComponents.push(React.createElement(\"script\", {\n    key: \"chunk-mapping\",\n    id: \"gatsby-chunk-mapping\",\n    dangerouslySetInnerHTML: {\n      __html: scriptChunkMapping\n    }\n  }));\n  var bodyScripts = [];\n\n  if (chunkMapping[\"polyfill\"]) {\n    chunkMapping[\"polyfill\"].forEach(function (script) {\n      var scriptPath = \"\" + __PATH_PREFIX__ + script;\n      bodyScripts.push(React.createElement(\"script\", {\n        key: scriptPath,\n        src: scriptPath,\n        noModule: true\n      }));\n    });\n  }\n\n  bodyScripts = bodyScripts.concat(scripts.filter(function (s) {\n    return s.rel !== \"prefetch\";\n  }).map(function (s) {\n    var scriptPath = __PATH_PREFIX__ + \"/\" + JSON.stringify(s.name).slice(1, -1);\n    return React.createElement(\"script\", {\n      key: scriptPath,\n      src: scriptPath,\n      async: true\n    });\n  }));\n\n  (_postBodyComponents = postBodyComponents).push.apply(_postBodyComponents, _toConsumableArray(bodyScripts));\n\n  apiRunner(\"onPreRenderHTML\", {\n    getHeadComponents: getHeadComponents,\n    replaceHeadComponents: replaceHeadComponents,\n    getPreBodyComponents: getPreBodyComponents,\n    replacePreBodyComponents: replacePreBodyComponents,\n    getPostBodyComponents: getPostBodyComponents,\n    replacePostBodyComponents: replacePostBodyComponents,\n    pathname: pagePath,\n    pathPrefix: __PATH_PREFIX__\n  });\n  var html = \"<!DOCTYPE html>\" + renderToStaticMarkup(React.createElement(Html, _extends({}, bodyProps, {\n    headComponents: headComponents,\n    htmlAttributes: htmlAttributes,\n    bodyAttributes: bodyAttributes,\n    preBodyComponents: preBodyComponents,\n    postBodyComponents: postBodyComponents,\n    body: bodyHtml,\n    path: pagePath\n  })));\n  callback(null, html);\n});","map":{"version":3,"sources":["C:/Users/admin/react/Website/web/.cache/static-entry.js"],"names":["React","require","fs","join","renderToString","renderToStaticMarkup","ServerLocation","Router","isRedirect","get","merge","isObject","flatten","uniqBy","flattenDeep","replace","concat","memoize","RouteAnnouncerProps","apiRunner","syncRequires","gatsbyVersion","version","grabMatchParams","stats","JSON","parse","readFileSync","process","cwd","chunkMapping","testRequireError","moduleName","err","regex","RegExp","firstLine","toString","split","test","Html","__esModule","default","getPageDataPath","path","fixedPagePath","getPageDataUrl","pagePath","pageDataPath","__PATH_PREFIX__","getStaticQueryUrl","hash","getPageData","absolutePageDataPath","pageDataRaw","appDataPath","getAppDataUrl","appData","absoluteAppDataPath","appDataRaw","loadPageDataSync","pageDataFile","pageDataJson","error","createElement","sanitizeComponents","components","componentsArray","ensureArray","map","component","__ASSET_PREFIX__","props","rel","cloneElement","href","Array","isArray","filter","val","length","callback","bodyHtml","headComponents","htmlAttributes","bodyAttributes","preBodyComponents","postBodyComponents","bodyProps","replaceBodyHTMLString","body","setHeadComponents","setHtmlAttributes","attributes","setBodyAttributes","setPreBodyComponents","setPostBodyComponents","setBodyProps","getHeadComponents","replaceHeadComponents","getPreBodyComponents","replacePreBodyComponents","getPostBodyComponents","replacePostBodyComponents","pageData","pageDataUrl","appDataUrl","componentChunkName","staticQueryHashes","staticQueryUrls","RouteHandler","result","params","location","pathname","pageContext","__params","pathContext","undefined","pageElement","wrappedPage","element","pop","Component","routerElement","__BASE_PATH__","bodyComponent","pathPrefix","e","scriptsAndStyles","s","fetchKey","chunks","namedChunkGroups","chunk","name","assets","forEach","asset","push","childAssets","sort","s1","s2","item","scripts","script","endsWith","styles","style","slice","reverse","staticQueryUrl","unshift","__html","windowPageData","scriptChunkMapping","stringify","bodyScripts","scriptPath","html"],"mappings":"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","sourcesContent":["const React = require(`react`)\nconst fs = require(`fs`)\nconst { join } = require(`path`)\nconst { renderToString, renderToStaticMarkup } = require(`react-dom/server`)\nconst { ServerLocation, Router, isRedirect } = require(`@reach/router`)\nconst {\n  get,\n  merge,\n  isObject,\n  flatten,\n  uniqBy,\n  flattenDeep,\n  replace,\n  concat,\n  memoize,\n} = require(`lodash`)\n\nconst { RouteAnnouncerProps } = require(`./route-announcer-props`)\nconst apiRunner = require(`./api-runner-ssr`)\nconst syncRequires = require(`$virtual/sync-requires`)\nconst { version: gatsbyVersion } = require(`gatsby/package.json`)\nconst { grabMatchParams } = require(`./find-path`)\n\nconst stats = JSON.parse(\n  fs.readFileSync(`${process.cwd()}/public/webpack.stats.json`, `utf-8`)\n)\n\nconst chunkMapping = JSON.parse(\n  fs.readFileSync(`${process.cwd()}/public/chunk-map.json`, `utf-8`)\n)\n\n// const testRequireError = require(\"./test-require-error\")\n// For some extremely mysterious reason, webpack adds the above module *after*\n// this module so that when this code runs, testRequireError is undefined.\n// So in the meantime, we'll just inline it.\nconst testRequireError = (moduleName, err) => {\n  const regex = new RegExp(`Error: Cannot find module\\\\s.${moduleName}`)\n  const firstLine = err.toString().split(`\\n`)[0]\n  return regex.test(firstLine)\n}\n\nlet Html\ntry {\n  Html = require(`../src/html`)\n} catch (err) {\n  if (testRequireError(`../src/html`, err)) {\n    Html = require(`./default-html`)\n  } else {\n    throw err\n  }\n}\n\nHtml = Html && Html.__esModule ? Html.default : Html\n\nconst getPageDataPath = path => {\n  const fixedPagePath = path === `/` ? `index` : path\n  return join(`page-data`, fixedPagePath, `page-data.json`)\n}\n\nconst getPageDataUrl = pagePath => {\n  const pageDataPath = getPageDataPath(pagePath)\n  return `${__PATH_PREFIX__}/${pageDataPath}`\n}\n\nconst getStaticQueryUrl = hash =>\n  `${__PATH_PREFIX__}/page-data/sq/d/${hash}.json`\n\nconst getPageData = pagePath => {\n  const pageDataPath = getPageDataPath(pagePath)\n  const absolutePageDataPath = join(process.cwd(), `public`, pageDataPath)\n  const pageDataRaw = fs.readFileSync(absolutePageDataPath)\n\n  try {\n    return JSON.parse(pageDataRaw.toString())\n  } catch (err) {\n    return null\n  }\n}\n\nconst appDataPath = join(`page-data`, `app-data.json`)\n\nconst getAppDataUrl = memoize(() => {\n  let appData\n\n  try {\n    const absoluteAppDataPath = join(process.cwd(), `public`, appDataPath)\n    const appDataRaw = fs.readFileSync(absoluteAppDataPath)\n    appData = JSON.parse(appDataRaw.toString())\n\n    if (!appData) {\n      return null\n    }\n  } catch (err) {\n    return null\n  }\n\n  return `${__PATH_PREFIX__}/${appDataPath}`\n})\n\nconst loadPageDataSync = pagePath => {\n  const pageDataPath = getPageDataPath(pagePath)\n  const pageDataFile = join(process.cwd(), `public`, pageDataPath)\n  try {\n    const pageDataJson = fs.readFileSync(pageDataFile)\n    return JSON.parse(pageDataJson)\n  } catch (error) {\n    // not an error if file is not found. There's just no page data\n    return null\n  }\n}\n\nconst createElement = React.createElement\n\nexport const sanitizeComponents = components => {\n  const componentsArray = ensureArray(components)\n  return componentsArray.map(component => {\n    // Ensure manifest is always loaded from content server\n    // And not asset server when an assetPrefix is used\n    if (__ASSET_PREFIX__ && component.props.rel === `manifest`) {\n      return React.cloneElement(component, {\n        href: replace(component.props.href, __ASSET_PREFIX__, ``),\n      })\n    }\n    return component\n  })\n}\n\nconst ensureArray = components => {\n  if (Array.isArray(components)) {\n    // remove falsy items and flatten\n    return flattenDeep(\n      components.filter(val => (Array.isArray(val) ? val.length > 0 : val))\n    )\n  } else {\n    // we also accept single components, so we need to handle this case as well\n    return components ? [components] : []\n  }\n}\n\nexport default (pagePath, callback) => {\n  let bodyHtml = ``\n  let headComponents = [\n    <meta\n      name=\"generator\"\n      content={`Gatsby ${gatsbyVersion}`}\n      key={`generator-${gatsbyVersion}`}\n    />,\n  ]\n  let htmlAttributes = {}\n  let bodyAttributes = {}\n  let preBodyComponents = []\n  let postBodyComponents = []\n  let bodyProps = {}\n\n  const replaceBodyHTMLString = body => {\n    bodyHtml = body\n  }\n\n  const setHeadComponents = components => {\n    headComponents = headComponents.concat(sanitizeComponents(components))\n  }\n\n  const setHtmlAttributes = attributes => {\n    htmlAttributes = merge(htmlAttributes, attributes)\n  }\n\n  const setBodyAttributes = attributes => {\n    bodyAttributes = merge(bodyAttributes, attributes)\n  }\n\n  const setPreBodyComponents = components => {\n    preBodyComponents = preBodyComponents.concat(sanitizeComponents(components))\n  }\n\n  const setPostBodyComponents = components => {\n    postBodyComponents = postBodyComponents.concat(\n      sanitizeComponents(components)\n    )\n  }\n\n  const setBodyProps = props => {\n    bodyProps = merge({}, bodyProps, props)\n  }\n\n  const getHeadComponents = () => headComponents\n\n  const replaceHeadComponents = components => {\n    headComponents = sanitizeComponents(components)\n  }\n\n  const getPreBodyComponents = () => preBodyComponents\n\n  const replacePreBodyComponents = components => {\n    preBodyComponents = sanitizeComponents(components)\n  }\n\n  const getPostBodyComponents = () => postBodyComponents\n\n  const replacePostBodyComponents = components => {\n    postBodyComponents = sanitizeComponents(components)\n  }\n\n  const pageData = getPageData(pagePath)\n  const pageDataUrl = getPageDataUrl(pagePath)\n\n  const appDataUrl = getAppDataUrl()\n\n  const { componentChunkName, staticQueryHashes = [] } = pageData\n\n  const staticQueryUrls = staticQueryHashes.map(getStaticQueryUrl)\n\n  class RouteHandler extends React.Component {\n    render() {\n      const props = {\n        ...this.props,\n        ...pageData.result,\n        params: {\n          ...grabMatchParams(this.props.location.pathname),\n          ...(pageData.result?.pageContext?.__params || {}),\n        },\n        // pathContext was deprecated in v2. Renamed to pageContext\n        pathContext: pageData.result ? pageData.result.pageContext : undefined,\n      }\n\n      const pageElement = createElement(\n        syncRequires.components[componentChunkName],\n        props\n      )\n\n      const wrappedPage = apiRunner(\n        `wrapPageElement`,\n        { element: pageElement, props },\n        pageElement,\n        ({ result }) => {\n          return { element: result, props }\n        }\n      ).pop()\n\n      return wrappedPage\n    }\n  }\n\n  const routerElement = (\n    <ServerLocation url={`${__BASE_PATH__}${pagePath}`}>\n      <Router id=\"gatsby-focus-wrapper\" baseuri={__BASE_PATH__}>\n        <RouteHandler path=\"/*\" />\n      </Router>\n      <div {...RouteAnnouncerProps} />\n    </ServerLocation>\n  )\n\n  const bodyComponent = apiRunner(\n    `wrapRootElement`,\n    { element: routerElement, pathname: pagePath },\n    routerElement,\n    ({ result }) => {\n      return { element: result, pathname: pagePath }\n    }\n  ).pop()\n\n  // Let the site or plugin render the page component.\n  apiRunner(`replaceRenderer`, {\n    bodyComponent,\n    replaceBodyHTMLString,\n    setHeadComponents,\n    setHtmlAttributes,\n    setBodyAttributes,\n    setPreBodyComponents,\n    setPostBodyComponents,\n    setBodyProps,\n    pathname: pagePath,\n    pathPrefix: __PATH_PREFIX__,\n  })\n\n  // If no one stepped up, we'll handle it.\n  if (!bodyHtml) {\n    try {\n      bodyHtml = renderToString(bodyComponent)\n    } catch (e) {\n      // ignore @reach/router redirect errors\n      if (!isRedirect(e)) throw e\n    }\n  }\n\n  // Create paths to scripts\n  let scriptsAndStyles = flatten(\n    [`app`, componentChunkName].map(s => {\n      const fetchKey = `assetsByChunkName[${s}]`\n\n      let chunks = get(stats, fetchKey)\n      const namedChunkGroups = get(stats, `namedChunkGroups`)\n\n      if (!chunks) {\n        return null\n      }\n\n      chunks = chunks.map(chunk => {\n        if (chunk === `/`) {\n          return null\n        }\n        return { rel: `preload`, name: chunk }\n      })\n\n      namedChunkGroups[s].assets.forEach(asset =>\n        chunks.push({ rel: `preload`, name: asset })\n      )\n\n      const childAssets = namedChunkGroups[s].childAssets\n      for (const rel in childAssets) {\n        chunks = concat(\n          chunks,\n          childAssets[rel].map(chunk => {\n            return { rel, name: chunk }\n          })\n        )\n      }\n\n      return chunks\n    })\n  )\n    .filter(s => isObject(s))\n    .sort((s1, s2) => (s1.rel == `preload` ? -1 : 1)) // given priority to preload\n\n  scriptsAndStyles = uniqBy(scriptsAndStyles, item => item.name)\n\n  const scripts = scriptsAndStyles.filter(\n    script => script.name && script.name.endsWith(`.js`)\n  )\n  const styles = scriptsAndStyles.filter(\n    style => style.name && style.name.endsWith(`.css`)\n  )\n\n  apiRunner(`onRenderBody`, {\n    setHeadComponents,\n    setHtmlAttributes,\n    setBodyAttributes,\n    setPreBodyComponents,\n    setPostBodyComponents,\n    setBodyProps,\n    pathname: pagePath,\n    loadPageDataSync,\n    bodyHtml,\n    scripts,\n    styles,\n    pathPrefix: __PATH_PREFIX__,\n  })\n\n  scripts\n    .slice(0)\n    .reverse()\n    .forEach(script => {\n      // Add preload/prefetch <link>s for scripts.\n      headComponents.push(\n        <link\n          as=\"script\"\n          rel={script.rel}\n          key={script.name}\n          href={`${__PATH_PREFIX__}/${script.name}`}\n        />\n      )\n    })\n\n  if (pageData) {\n    headComponents.push(\n      <link\n        as=\"fetch\"\n        rel=\"preload\"\n        key={pageDataUrl}\n        href={pageDataUrl}\n        crossOrigin=\"anonymous\"\n      />\n    )\n  }\n  staticQueryUrls.forEach(staticQueryUrl =>\n    headComponents.push(\n      <link\n        as=\"fetch\"\n        rel=\"preload\"\n        key={staticQueryUrl}\n        href={staticQueryUrl}\n        crossOrigin=\"anonymous\"\n      />\n    )\n  )\n\n  if (appDataUrl) {\n    headComponents.push(\n      <link\n        as=\"fetch\"\n        rel=\"preload\"\n        key={appDataUrl}\n        href={appDataUrl}\n        crossOrigin=\"anonymous\"\n      />\n    )\n  }\n\n  styles\n    .slice(0)\n    .reverse()\n    .forEach(style => {\n      // Add <link>s for styles that should be prefetched\n      // otherwise, inline as a <style> tag\n\n      if (style.rel === `prefetch`) {\n        headComponents.push(\n          <link\n            as=\"style\"\n            rel={style.rel}\n            key={style.name}\n            href={`${__PATH_PREFIX__}/${style.name}`}\n          />\n        )\n      } else {\n        headComponents.unshift(\n          <style\n            data-href={`${__PATH_PREFIX__}/${style.name}`}\n            id={`gatsby-global-css`}\n            dangerouslySetInnerHTML={{\n              __html: fs.readFileSync(\n                join(process.cwd(), `public`, style.name),\n                `utf-8`\n              ),\n            }}\n          />\n        )\n      }\n    })\n\n  // Add page metadata for the current page\n  const windowPageData = `/*<![CDATA[*/window.pagePath=\"${pagePath}\";/*]]>*/`\n\n  postBodyComponents.push(\n    <script\n      key={`script-loader`}\n      id={`gatsby-script-loader`}\n      dangerouslySetInnerHTML={{\n        __html: windowPageData,\n      }}\n    />\n  )\n\n  // Add chunk mapping metadata\n  const scriptChunkMapping = `/*<![CDATA[*/window.___chunkMapping=${JSON.stringify(\n    chunkMapping\n  )};/*]]>*/`\n\n  postBodyComponents.push(\n    <script\n      key={`chunk-mapping`}\n      id={`gatsby-chunk-mapping`}\n      dangerouslySetInnerHTML={{\n        __html: scriptChunkMapping,\n      }}\n    />\n  )\n\n  let bodyScripts = []\n  if (chunkMapping[`polyfill`]) {\n    chunkMapping[`polyfill`].forEach(script => {\n      const scriptPath = `${__PATH_PREFIX__}${script}`\n      bodyScripts.push(\n        <script key={scriptPath} src={scriptPath} noModule={true} />\n      )\n    })\n  }\n\n  // Filter out prefetched bundles as adding them as a script tag\n  // would force high priority fetching.\n  bodyScripts = bodyScripts.concat(\n    scripts\n      .filter(s => s.rel !== `prefetch`)\n      .map(s => {\n        const scriptPath = `${__PATH_PREFIX__}/${JSON.stringify(s.name).slice(\n          1,\n          -1\n        )}`\n        return <script key={scriptPath} src={scriptPath} async />\n      })\n  )\n\n  postBodyComponents.push(...bodyScripts)\n\n  apiRunner(`onPreRenderHTML`, {\n    getHeadComponents,\n    replaceHeadComponents,\n    getPreBodyComponents,\n    replacePreBodyComponents,\n    getPostBodyComponents,\n    replacePostBodyComponents,\n    pathname: pagePath,\n    pathPrefix: __PATH_PREFIX__,\n  })\n\n  const html = `<!DOCTYPE html>${renderToStaticMarkup(\n    <Html\n      {...bodyProps}\n      headComponents={headComponents}\n      htmlAttributes={htmlAttributes}\n      bodyAttributes={bodyAttributes}\n      preBodyComponents={preBodyComponents}\n      postBodyComponents={postBodyComponents}\n      body={bodyHtml}\n      path={pagePath}\n    />\n  )}`\n\n  callback(null, html)\n}\n"]},"metadata":{},"sourceType":"module"}